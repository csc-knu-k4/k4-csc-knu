<?xml version="1.0" encoding="utf-8"?>

<Border xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:controls="clr-namespace:OsvitaApp.Pages.Controls"
        xmlns:vm="clr-namespace:OsvitaApp.PageModels"
        xmlns:om="clr-namespace:OsvitaApp.Models.ObservableModels"
        xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
        x:Class="OsvitaApp.Pages.Controls.ChapterView"
        x:DataType="om:ChapterObservableModel"
        Stroke="#f4f4f4"
        StrokeThickness="1"
        BackgroundColor="White"
        Padding="10"
        StrokeShape="RoundRectangle 15">

    <Border.Resources>
        <ResourceDictionary>
            <mct:IsNullConverter x:Key="IsNullConverter" />
        </ResourceDictionary>
    </Border.Resources>
    <VerticalStackLayout>
        <Grid>
            <Label Text="{Binding Title}"
                   FontSize="20"
                   VerticalOptions="Center" />
            <ImageButton Source="{x:StaticResource ArrowDown}"
                         HorizontalOptions="End"
                         Command="{Binding x:DataType='vm:ChaptersPageVM', Source={RelativeSource AncestorType={x:Type vm:ChaptersPageVM}}, Path=ChapterExpandedCommand}"
                         CommandParameter="{Binding .}">
                <ImageButton.Triggers>
                    <DataTrigger TargetType="ImageButton"
                                 Binding="{Binding IsExpanded}"
                                 Value="True">
                        <Setter Property="Source"
                                Value="{x:StaticResource ArrowUp}" />
                    </DataTrigger>
                </ImageButton.Triggers>

            </ImageButton>
        </Grid>

        <VerticalStackLayout IsVisible="{Binding IsExpanded}">
            <Label Text="Завантаження тем..."
                   IsVisible="{Binding Topics, Converter={StaticResource IsNullConverter}}" />
            <Line Fill="#000000"
                  Opacity="0.15"
                  BackgroundColor="#000000"
                  HeightRequest="1" />
            <CollectionView ItemsSource="{Binding Topics}"
                            Margin="0, 20, 0, 0">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical"
                                       ItemSpacing="7.5" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="om:TopicObservableModel">
                        <controls:TopicView>
                            <ContentView.GestureRecognizers>
                                <TapGestureRecognizer
                                    Command="{Binding x:DataType='vm:ChaptersPageVM', Source={RelativeSource AncestorType={x:Type vm:ChaptersPageVM}}, Path=TopicClickedCommand}"
                                    CommandParameter="{Binding .}" />

                            </ContentView.GestureRecognizers>
                        </controls:TopicView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </VerticalStackLayout>
</Border>